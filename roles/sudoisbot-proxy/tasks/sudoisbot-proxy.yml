---

- name: template config
  template:
    src: sudoisbot-proxy.yml.j2
    dest: /usr/local/etc/sudoisbot-proxy.yml
  notify: restart sudoisbot-proxy

- name: start docker container
  docker_container:
    name: "sudoisbot_proxy"
    image: "benediktkr/sudoisbot-proxy:latest"
    auto_remove: no
    detach: yes
    pull: yes
    restart_policy: "unless-stopped"
    state: started
    ports:
      - "{{ zmq_proxy_backend_port }}:{{ zmq_proxy_backend_port }}/tcp"
      - "{{ zmq_proxy_frontend_port }}:{{ zmq_proxy_frontend_port }}/tcp"
    volumes:
      - /usr/local/etc/sudoisbot-proxy.yml:/etc/sudoisbot-proxy.yml
  tags: sudoisbot-proxy-container
