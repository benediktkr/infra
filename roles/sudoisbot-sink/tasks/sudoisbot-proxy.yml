---

- name: template config
  template:
    src: sudoisbot-sink.yml.j2
    dest: /usr/local/etc/sudoisbot-sink.yml
  notify: restart sudoisbot-sink

- name: start docker container
  docker_container:
    name: "sudoisbot_sink"
    image: "benediktkr/sudoisbot-sink:latest"
    auto_remove: no
    detach: yes
    pull: yes
    restart_policy: "unless-stopped"
    state: started
    env:
      SUDOISBOT_CONF: /etc/sudoisbot-sink.yml
    ports:
      - "{{ zmq_sink_backend_port }}:{{ zmq_sink_frontend_port }}/tcp"
      - "{{ zmq_sink_frontend_port }}:{{ zmq_sink_frontend_port }}/tcp"
    volumes:
      - /usr/local/etc/sudoisbot-sink.yml:/etc/sudoisbot-sink.yml
  tags: sudoisbot-sink-container
