---

- name: matrix-bridge-email config
  template:
    src: bridge-email-cfg.json.j2
    dest: "{{ systemuserlist.matrix.home }}/bridge-email/cfg.json"
    owner: matrix
    group: matrix
    mode: 0640

- name: start matrix-bridge-email container
  docker_container:
    name: matrix-bridge-email
    image: jojii/matrix_email_bridge
    auto_remove: no
    detach: yes
    pull: yes
    restart_policy: "unless-stopped"
    state: stopped
    container_default_behavior: compatibility
    user: "{{ systemuserlist.matrix.uid }}:{{ systemuserlist.matrix.gid }}"
    networks_cli_compatible: no
    networks:
      - name: bridgewithdns
        ipv4_address: "{{ bridgewithdns.matrix_email }}"
    mounts:
      - type: bind
        source: "{{ systemuserlist.matrix.home }}/bridge-email"
        target: /app/data
        read_only: no
  tags:
    - matrix-bridge-email-container
    - docker-containers
