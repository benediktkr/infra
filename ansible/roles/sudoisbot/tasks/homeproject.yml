---

- name: should only show on right hosts
  debug:
    var: inventory_hostname

- name: create group for temps user
  group:
    name: "{{ temps_user }}"
    system: yes
  tags:
    - users
    - temper_sub
    - temper_pub

- name: adding my user to temps group
  user:
    name: "{{ myusername }}"
    groups: "{{ temps_user }}"
    append: yes
  tags:
    - users
    - temper_sub
    - temper_pub

- name: create temps user ({{ temps_user }})
  user:
    name: "{{ temps_user }}"
    group: "{{ temps_user }}"
    create_home: no
    system: yes
  tags:
    - users
    - temper_sub
    - temper_pub

- name: make dir for temps data
  file:
    state: directory
    path: "{{ temps_dir }}"
    owner: "{{ temps_user }}"
    group: "{{ temps_user }}"
    mode: 0775
  tags:
    - temper_sub

- name: install systemd config for proxy_pubsub
  template:
    src: proxy_pubsub.systemd.j2
    dest: "/etc/systemd/system/proxy_pubsub.service"
  vars:
  tags:
    - mysystemd
    - proxy_pubsub
  notify:
    - daemon-reload
    - restart proxy_pubsub
  when: "'proxy_pubsub' in services_enabled"

- name: install systemd config for temper_sub
  template:
    src: temper_sub.systemd.j2
    dest: "/etc/systemd/system/temper_sub.service"
  vars:
  tags:
    - mysystemd
    - temper_sub
  notify:
    - daemon-reload
    - restart temper_sub
  when: "'temper_sub' in services_enabled"

- name: install systemd config for temper_pub
  template:
    src: temper_pub.systemd.j2
    dest: "/etc/systemd/system/temper_pub.service"
  vars:
  tags:
    - mysystemd
    - temper_pub
  notify:
    - daemon-reload
    - restart temper_pub
  when: "'temper_pub' in services_enabled"

- name: install systemd config for screen_pub
  template:
    src: screen_pub.systemd.j2
    dest: "/etc/systemd/system/screen_pub.service"
  vars:
  tags:
    - mysystemd
    - screen_pub
  notify:
    - daemon-reload
    - restart screen_pub
  when: "'screen_pub' in services_enabled"
