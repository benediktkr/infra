---

- name: should only show on right hosts
  debug:
    var: inventory_hostname

- name: create group for temps user
  group:
    name: "{{ temps_user }}"
    system: yes
  tags:
    - users
    - temper_sub
    - temper_pub

- name: adding users to temps group
  user:
    name: "{{ item }}"
    groups: "{{ temps_user }}"
    append: yes
  with_items:
    - "{{ myusername }}"
    - "{{ tglistener_user }}"
  tags:
    - users
    - temper_sub
    - temper_pub

- name: create temps user ({{ temps_user }})
  user:
    name: "{{ temps_user }}"
    group: "{{ temps_user }}"
    create_home: no
    system: yes
  tags:
    - users
    - temper_sub
    - temper_pub

- name: make dir for temps data
  file:
    state: directory
    path: "{{ temps_dir }}"
    owner: "{{ temps_user }}"
    group: "{{ temps_user }}"
    mode: 0775
  tags:
    - temper_sub

- name: install systemd configs
  template:
    src: "{{ item }}.systemd.j2"
    dest: "/etc/systemd/system/{{ item }}.service"
  vars:
  tags:
    - mysystemd
  notify:
    - daemon-reload
    - restart {{ item }}
  with_items: "{{ services_enabled }}"
