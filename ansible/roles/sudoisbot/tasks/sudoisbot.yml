---

- name: create directory for logs
  file:
   path: /srv/log
   state: directory
   mode: '0777'
   owner: root
   group: root

- name: template config
  template:
    src: private/sudoisbot.yml.j2
    dest: /etc/sudoisbot.yml
  tags:
    - sudoisbot_install
    - checkclients
    - sudoisbot_homeproject
    - homeproject
    - vpnserver
    - sudoisbot_config
  notify:
    - restart all
    - restart tglistener

- name: create tglistener user ({{ tglistener_user }})
  user:
    name: "{{ tglistener_user }}"
    group: "{{ tglistener_user }}"
    create_home: no
    system: yes
  tags:
    - users
  when: tglistener_enabled

- name: install systemd config for tglistener
  template:
    src: tglistener.systemd.j2
    dest: "/etc/systemd/system/tglistener.service"
  vars:
  tags:
    - mysystemd
  notify:
    - daemon-reload
    - restart tglistener
  when: tglistener_enabled

- name: pip3 upgrade
  pip:
    name: pip
    extra_args: --upgrade
    state: latest
    executable: pip3
  tags:
    - sudoisbot_install

# change state to 'latest' when thinngs are stable
- name: install from git
  pip:
    name: git+https://github.com/benediktkr/sudoisbot.git
    state: latest
    executable: pip3
  tags:
    - sudoisbot_install
    - checkclients
    - sudoisbot_homeproject
    - homeproject
  notify: restart all
  when: False
