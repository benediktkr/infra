---

- name: remove pi user
  user:
    name: pi
    state: absent
  tags:
    - users

- name: install locales and kernel headers
  apt:
    name:
      - locales
      - raspberrypi-kernel-headers
    state: present
  tags:
    - vpnclient

- name: dpkg-reconfigure locales
  debconf:
    name: locales

- name: add apt key DEBIAN repo
  apt_key:
    id: "{{ item }}"
    state: present
    keyserver: hkp://pool.sks-keyservers.net:80
  with_items:
    - 04EE7237B7D453EC
    - 648ACFD622F3D138
  tags:
    - vpnclient

- name: copy file to set low priority for DEBIAN unstable packages
  copy:
    src: limit-unstable
    dest: /etc/apt/preferences.d/limit-unstable
  when: wireguard_clients.get(inventory_hostname)
  tags:
    - vpnclient

- name: add DEBIAN unstable repo for wireguard
  apt_repository:
    repo: "deb http://deb.debian.org/debian/ unstable main"
    state: present
    update_cache: yes
  tags:
    - packages
    - vpnclient
  when: wireguard_clients.get(inventory_hostname)
