---

- name: check if motion is installed
  stat:
    path: /etc/motion/motion.conf
  register: mdotcexist

- name: install motion from github
  apt:
    #deb: "https://github.com/Motion-Project/motion/releases/download/release-4.1.1/pi_stretch_motion_4.1.1-1_armhf.deb"
    deb: "https://github.com/Motion-Project/motion/releases/download/release-4.1.1/artful_motion_4.1.1-1_amd64.deb"
  when: mdotcexist == False

- name: enable motion in /etc/default
  lineinfile:
    path: /etc/default/motion
    regexp: "start_motion_daemon"
    line: "start_motion_daemon=yes"
  tags:
    - conf
  notify: reload motion

- name: create motion target dir
  file:
    state: directory
    path: "{{ motion_target_dir }}"
    owner: motion

- name: motion.conf
  template:
    src: motion.conf.j2
    dest: /etc/motion/motion.conf
  notify: reload motion

- name: adding my user to motion group
  user:
    name: "{{ myusername }}"
    groups: motion
    append: yes
