---
- name: add ssh hostkey known hosts for git
  lineinfile:
    path: /etc/ssh/ssh_known_hosts"
    line: "{{ github_hostkey }}"
    create: yes

- name: create dir structure
  file:
    path: "{{ dotfiles_path }}"
    state: directory
    mode: 0750
    owner: "{{ myusername }}"

- name: pull my dotfiles repo
  git:
    repo: "{{ dotfiles_repo }}"
    dest: "{{ dotfiles_path }}"
    version: master
    clone: yes
    update: yes
    force: yes
  become_user: "{{ myusername }}"
  ignore_errors: yes


- name: put my dotfiles in place
  file:
    src: "{{ dotfiles_path }}/{{ item.src }}"
    dest: "~/{{ item.dest }}"
    mode: "{{ mode | default(755) }}"
    state: file
  with_items:
    - "{{ dotfiles }}"
  become_user: "{{ myusername }}"

- name: put dotfiles for root in place
  file:
    src: "{{ dotfiles_path }}/{{ item.src }}"
    dest: "/root/{{ item.dest }}"
    mode: "{{ mode | default(755) }}"
    state: file
  with_items:
    - "{{ dotfiles }}"
